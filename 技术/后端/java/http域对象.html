<!DOCTYPE html>
<html><head>
<title>HTTP域对象</title>
<base href="../../..">
<meta id="root-path" root-path="../../..">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
<meta charset="UTF-8">
<meta name="description" content="尘影迹痕 - HTTP域对象">
<meta property="og:title" content="HTTP域对象">
<meta property="og:description" content="尘影迹痕 - HTTP域对象">
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.cytl2.eu.org/技术/后端/java/http域对象.html">
<meta property="og:image" content="https://pic.imgdb.cn/item/631aafb516f2c2beb1384560.jpg">
<meta property="og:site_name" content="尘影迹痕">
<meta name="author" content="lzy"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://blog.cytl2.eu.org/lib/rss.xml"></head><body class="publish css-settings-manager theme-light show-inline-title h2-underline tbMH-yuan tbMH-qk tbMH-ds-cg tbMH-kd-ncc-jy is-focused"><include src="lib/html/custom-head-content.html"></include><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.svg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(const t of e){let e=t.getAttribute("src");try{const o=await fetch(e);if(!o.ok){console.log("Could not include file: "+e),t?.remove();continue}let l=await o.text(),n=document.createRange().createContextualFragment(l),c=Array.from(n.children);for(let e of c)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);t.before(n),t.remove(),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="HTTP域对象"><p>HTTP域对象</p></h1><div class="heading-wrapper"><div class="heading-children"><div class="heading-wrapper"><h2 data-heading="什么是HTTP" class="heading" id="什么是HTTP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>什么是HTTP</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="概念" class="heading" id="概念"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>概念</h3><div class="heading-children"><div><p>HyperText Transfer Protocol，超文本传输协议，规定了浏览器和服务器之间数据传输的规则。</p></div><div><p><mark>所以学习HTTP主要就是学习请求和响应数据的具体格式内容。</mark></p></div><div><p><strong>HTTP协议特点</strong></p></div><div><p>HTTP协议有它自己的一些特点，分别是:</p></div><div><ul>
<li data-line="0">
<p>基于TCP协议: 面向连接，安全</p>
<p>TCP是一种面向连接的(建立连接之前是需要经过三次握手)、可靠的、基于字节流的传输层通信协议，在数据传输方面更安全。</p>
</li>
<li data-line="4">
<p>基于请求-响应模型的:一次请求对应一次响应</p>
<p>请求和响应是一一对应关系</p>
</li>
<li data-line="8"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>HTTP协议是无状态协议:对于事物处理没有记忆能力。每次请求-响应都是独立的</p>
<p>无状态指的是客户端发送HTTP请求给服务端之后，服务端根据请求响应数据，响应完后，不会记录任何信息。这种特性有优点也有缺点，</p>
<ul>
<li data-line="12">缺点:多次请求间不能共享数据</li>
<li data-line="13">优点:速度快</li>
</ul>
<p>请求之间无法共享数据会引发的问题，如:</p>
<ul>
<li data-line="17">京东购物，<code>加入购物车</code>和<code>去购物车结算</code>是两次请求，</li>
<li data-line="18">HTTP协议的无状态特性，加入购物车请求响应结束后，并未记录加入购物车是何商品</li>
<li data-line="19">发起去购物车结算的请求后，因为无法获取哪些商品加入了购物车，会导致此次请求无法正确展示数据</li>
</ul>
<p>具体使用的时候，我们发现京东是可以正常展示数据的，原因是Java早已考虑到这个问题，并提出了使用<code>会话技术(Cookie、Session)</code>来解决这个问题。具体如何来做，我们后面会详细讲到。刚才提到HTTP协议是规定了请求和响应数据的格式，那具体的格式是什么呢?</p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="请求数据格式" class="heading" id="请求数据格式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>请求数据格式</h3><div class="heading-children"><div><p>请求数据总共分为三部分内容，分别是<mark>请求行</mark>、<mark>请求头</mark>、<mark>请求体</mark></p></div><div><p><img src="https://pic.imgdb.cn/item/631aafb516f2c2beb1384560.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><ul>
<li data-line="0">
<p>请求行: HTTP请求中的第一行数据，请求行包含三块内容，分别是 GET[请求方式] /[请求URL路径] HTTP/1.1[HTTP协议及版本]</p>
<p>请求方式有七种,最常用的是GET和POST</p>
</li>
<li data-line="4"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>请求头: 第二行开始，格式为key: value形式</p>
<p>请求头中会包含若干个属性，常见的HTTP请求头有:</p>
<pre><code>Host: 表示请求的主机名
User-Agent: 浏览器版本,例如Chrome浏览器的标识类似Mozilla/5.0 ...Chrome/79，IE浏览器的标识类似Mozilla/5.0 (Windows NT ...)like Gecko；
Accept：表示浏览器能接收的资源类型，如text/*，image/*或者*/*表示所有；
Accept-Language：表示浏览器偏好的语言，服务器可以据此返回不同语言的网页；
Accept-Encoding：表示浏览器可以支持的压缩类型，例如gzip, deflate等。
</code><button class="copy-code-button">复制</button></pre>
<p> <mark>这些数据有什么用处?</mark></p>
<p>举例说明:服务端可以根据请求头中的内容来获取客户端的相关信息，有了这些信息服务端就可以处理不同的业务需求，比如:</p>
<ul>
<li data-line="20">不同浏览器解析HTML和CSS标签的结果会有不一致，所以就会导致相同的代码在不同的浏览器会出现不同的效果</li>
<li data-line="21">服务端根据客户端请求头中的数据获取到客户端的浏览器类型，就可以根据不同的浏览器设置不同的代码来达到一致的效果</li>
<li data-line="22">这就是我们常说的浏览器兼容问题</li>
</ul>
</li>
<li data-line="24"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>请求体: POST请求的最后一部分，存储请求参数</p>
<p><img src="https://pic.imgdb.cn/item/631ab01616f2c2beb138b4d2.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
<p>如上图红线框的内容就是请求体的内容，请求体和请求头之间是有一个空行隔开。此时浏览器发送的是POST请求，为什么不能使用GET呢?这时就需要回顾GET和POST两个请求之间的区别了:</p>
<ul>
<li data-line="30">GET请求请求参数在请求行中，没有请求体，POST请求请求参数在请求体中</li>
<li data-line="31">GET请求请求参数大小有限制，POST没有</li>
</ul>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="响应数据格式" class="heading" id="响应数据格式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>响应数据格式</h3><div class="heading-children"><div><p>响应数据总共分为三部分内容，分别是<mark>响应行</mark>、<mark>响应头</mark>、<mark>响应体</mark></p></div><div><p><img src="https://pic.imgdb.cn/item/631ab01616f2c2beb138b4d2.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><ul>
<li data-line="0">
<p>响应行：响应数据的第一行,响应行包含三块内容，分别是 HTTP/1.1[HTTP协议及版本] 200<a data-href="网络响应状态码" href="技术/后端/java/网络响应状态码.html" class="internal-link" target="_self" rel="noopener">网络响应状态码</a>] ok[状态码的描述]</p>
</li>
<li data-line="2">
<p>响应头：第二行开始，格式为key：value形式</p>
<p>响应头中会包含若干个属性，常见的HTTP响应头有:</p>
<pre><code>Content-Type：表示该响应内容的类型，例如text/html，image/jpeg；
Content-Length：表示该响应内容的长度（字节数）；
Content-Encoding：表示该响应压缩算法，例如gzip；
Cache-Control：指示客户端应如何缓存，例如max-age=300表示可以最多缓存300秒
</code><button class="copy-code-button">复制</button></pre>
</li>
<li data-line="13">
<p>响应体： 最后一部分。存放响应数据</p>
<p>上图中<code>&lt;html&gt;...&lt;html&gt;</code>这部分内容就是响应体，它和响应头之间有一个空行隔开。</p>
</li>
</ul></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="请求域对象" class="heading" id="请求域对象"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>请求域对象</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="什么是请求域对象" class="heading" id="什么是请求域对象"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>什么是请求域对象</h3><div class="heading-children"><div><p><mark>Request是请求对象，Response是响应对象。</mark>这两个对象在我们使用Servlet的时候有看到：</p></div><div><p><img src="https://pic.imgdb.cn/item/6319dbf416f2c2beb164850c.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>此时，我们就需要思考一个问题request和response这两个参数的作用是什么?</p></div><div><p><img src="https://pic.imgdb.cn/item/6319dc1116f2c2beb164a90d.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><ul>
<li data-line="0"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>request:<mark>获取</mark>请求数据
<ul>
<li data-line="1">浏览器会发送HTTP请求到后台服务器[Tomcat]</li>
<li data-line="2">HTTP的请求中会包含很多请求数据[请求行+请求头+请求体]</li>
<li data-line="3">后台服务器[Tomcat]会对HTTP请求中的数据进行解析并把解析结果存入到一个对象中</li>
<li data-line="4">所存入的对象即为request对象，所以我们可以从request对象中获取请求的相关参数</li>
<li data-line="5">获取到数据后就可以继续后续的业务，比如获取用户名和密码就可以实现登录操作的相关业务</li>
</ul>
</li>
<li data-line="6"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>response:<mark>设置</mark>响应数据
<ul>
<li data-line="7">业务处理完后，后台就需要给前端返回业务处理的结果即响应数据</li>
<li data-line="8">把响应数据封装到response对象中</li>
<li data-line="9">后台服务器[Tomcat]会解析response对象,按照[响应行+响应头+响应体]格式拼接结果</li>
<li data-line="10">浏览器最终解析结果，把内容展示在浏览器给用户浏览</li>
</ul>
</li>
</ul></div><div><p>对于上述所讲的内容，我们通过一个案例来初步体验下request和response对象的使用。</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/demo3"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo3</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//使用request对象 获取请求数据</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//url?name=zhangsan</span>

        <span class="token comment">//使用response对象 设置响应数据</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"content-type"</span><span class="token punctuation">,</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">",欢迎您！&lt;/h1&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Post..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>启动成功后就可以通过浏览器来访问，并且根据传入参数的不同就可以在页面上展示不同的内容:</p></div><div><p><strong>小结</strong></p></div><div><p>在这节中，我们主要认识了下request对象和reponse对象:</p></div><div><ul>
<li data-line="0">request对象是用来封装请求数据的对象</li>
<li data-line="1">response对象是用来封装响应数据的对象</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="Request对象" class="heading" id="Request对象"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Request对象</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="Request继承体系" class="heading" id="Request继承体系"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Request继承体系</h4><div class="heading-children"><div><p>在介绍Request和Reponse对象的时候，不难发现：</p></div><div><ul>
<li data-line="0">当我们的Servlet类实现的是Servlet接口的时候，service方法中的参数是ServletRequest和ServletResponse</li>
<li data-line="1">当我们的Servlet类继承的是HttpServlet类的时候，doGet和doPost方法中的参数就变成HttpServletRequest和HttpServletReponse</li>
</ul></div><div><p>那么首先，我们先来看下Request的继承体系:</p></div><div><p><img src="https://pic.imgdb.cn/item/631b09a516f2c2beb1a8515c.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>从上图中可以看出，ServletRequest和HttpServletRequest都是Java提供的，所以我们可以打开JavaEE提供的API文档[参考: 资料/JavaEE7-api.chm],打开后可以看到:</p></div><div><p><img src="https://pic.imgdb.cn/item/631b09c716f2c2beb1a87452.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>所以ServletRequest和HttpServletRequest是继承关系，并且两个都是接口，接口是无法创建对象，这个时候就引发了下面这个问题:</p></div><div><p><img src="https://pic.imgdb.cn/item/631b09e816f2c2beb1a891b6.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>这个时候，我们就需要用到Request继承体系中的<code>RequestFacade</code>:</p></div><div><ul>
<li data-line="0">该类实现了HttpServletRequest接口，也间接实现了ServletRequest接口。</li>
<li data-line="1"><strong>Servlet类中的service方法、doGet方法或者是doPost方法最终都是由Web服务器[Tomcat]来调用的，所以Tomcat提供了方法参数接口的具体实现类，并完成了对象的创建</strong></li>
<li data-line="2">要想了解RequestFacade中都提供了哪些方法，我们可以直接查看JavaEE的API文档中关于ServletRequest和HttpServletRequest的接口文档，因为RequestFacade实现了其接口就需要重写接口中的方法</li>
</ul></div><div><p>对于上述结论，要想验证，可以编写一个Servlet，在方法中把request对象打印下，就能看到最终的对象是不是RequestFacade,代码如下:</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/demo2"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo2</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>启动服务器，运行访问<code>http://localhost:8080/request-demo/demo2</code>,得到运行结果</p></div><div><p><strong>小结</strong></p></div><div><ul>
<li data-line="0">Request的继承体系为<code>ServletRequest--&gt;HttpServletRequest--&gt;RequestFacade</code></li>
<li data-line="1">Tomcat需要解析请求数据，封装为request对象,并且创建request对象传递到service方法</li>
<li data-line="2">使用request对象，可以查阅JavaEE API文档的HttpServletRequest接口中方法说明</li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="Request获取请求数据" class="heading" id="Request获取请求数据"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Request获取请求数据</h4><div class="heading-children"><div><p>HTTP请求数据总共分为三部分内容，分别是<mark>请求行、请求头、请求体</mark>，对于这三部分内容的数据，分别该如何获取如下：</p></div><div><p><img src="https://pic.imgdb.cn/item/6319df5316f2c2beb1684ae9.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>小结</strong></p></div><div><ul>
<li data-line="0">注意: <mark>浏览器发送的POST请求才有请求体</mark></li>
<li data-line="1">如果是纯文本数据:getReader()</li>
<li data-line="2">如果是字节数据如文件数据:getInputStream()</li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="Request通用方式获取请求参数【√】" class="heading" id="Request通用方式获取请求参数【√】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Request通用方式获取请求参数【√】</h4><div class="heading-children"><div><p>为什么要有通用请求方式？因为我们无论是GET还是POST请求，我们解析得到参数数据后执行的都会是相同的处理逻辑，唯一的区别就是解析得到参数的逻辑因为GET和POST的请求方式不一样而导致解析参数逻辑的不一样，所以我们只要封装两个逻辑为一个通用类即可实现，Request本身就实现了这样的通用方式。底层原理如下图示：</p></div><div><p><img src="https://pic.imgdb.cn/item/6319e6a116f2c2beb170f6da.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>小结</strong></p></div><div><ul>
<li data-line="0">
<p>req.getParameter()方法使用的频率会比较高</p>
</li>
<li data-line="2">
<p>以后我们再写代码的时候，就只需要按照如下格式来编写:</p>
</li>
</ul></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestDemo1</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
       <span class="token comment">//采用request提供的获取请求参数的通用方式来获取请求参数</span>
       <span class="token comment">//编写其他的业务代码...</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="IDEA模板创建Servlet" class="heading" id="IDEA模板创建Servlet"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IDEA模板创建Servlet</h4><div class="heading-children"><div><p>因为其实这个模板基本固定，不如利用Idea自带的模板功能diy自己的Servlet模板方便一键生成，主要是Idea自带的Servlet模板还不够便捷。</p></div><div><p><img src="https://pic.imgdb.cn/item/631a094f16f2c2beb19feb6f.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>配置好想要的模板后，不是直接在new一个类了，选择new 一个Servlet即可生成模板类。</p></div><div><blockquote>
<p>需要先导入Servlet的API，并且Maven完成刷新才能看到这个选项</p>
</blockquote></div><div><p><strong>一些实用模板参考</strong></p></div><div><p><a data-tooltip-position="top" aria-label="https://www.jb51.net/article/213572.htm" rel="noopener" class="external-link is-unresolved" href="https://www.jb51.net/article/213572.htm" target="_self">浅谈IDEA实用的Servlet模板<em>java</em>脚本之家 (jb51.net)</a></p></div></div></div><div class="heading-wrapper"><h4 data-heading="请求参数中文乱码问题" class="heading" id="请求参数中文乱码问题"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>请求参数中文乱码问题</h4><div class="heading-children"><div><p><strong>产生的原因</strong></p></div><div><p>浏览器本身是不能识别中文汉字的，所有的汉字（在计算机底层是二进制数）在请求的时候浏览器都会先对这些二进制数进行URL编码（编码格式是UTF-8），再将编码后的数据传递给Tomcat服务器而<strong>Tomcat7及以前的版本</strong>是按照写死的ISO-8859-1的编码方式去接码这些数据的所以就会导致中文乱码，如下图所示：（<strong>GET请求产生乱码分析图</strong>）</p></div><div><p><img src="https://pic.imgdb.cn/item/631b260216f2c2beb1c92239.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>解决思路</strong></p></div><div><p>上图可以看出，</p></div><div><ul>
<li data-line="0">
<p>在进行编码和解码的时候，不管使用的是哪个字符集，他们对应的<code>%E5%BC%A0%E4%B8%89</code>是一致的</p>
</li>
<li data-line="2"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>那他们<strong>对应的二进制值也是一样</strong>的，为:</p>
<ul>
<li data-line="4">
<pre><code>1110 0101 1011 1100 1010 0000 1110 0100 1011 1000 1000 1001
</code><button class="copy-code-button">复制</button></pre>
</li>
</ul>
</li>
<li data-line="8">
<p>为所以我们可以考虑把<code>å¼ ä¸</code>转换成字节，在把字节转换成<code>张三</code>，在转换的过程中是它们的编码一致，就可以解决中文乱码问题。</p>
</li>
</ul></div><div><p>具体的实现步骤为:</p></div><div><ol>
<li data-line="0">按照ISO-8859-1编码获取乱码<code>å¼ ä¸</code>对应的字节数组</li>
<li data-line="1">按照UTF-8编码获取字节数组对应的字符串</li>
</ol></div><div><p>实现代码如下:</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">URLDemo</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span>
        <span class="token comment">//1. URL编码</span>
        <span class="token class-name">String</span> encode <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. URL解码</span>
        <span class="token class-name">String</span> decode <span class="token operator">=</span> <span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encode<span class="token punctuation">,</span> <span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>decode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//此处打印的是对应的乱码数据</span>

        <span class="token comment">//3. 转换为字节数据,编码</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> decode<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token comment">//此处打印的是:-27 -68 -96 -28 -72 -119</span>
        <span class="token comment">//4. 将字节数组转为字符串，解码</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//此处打印的是张三</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p><strong>解决方案</strong></p></div><div><p>GET请求参数乱码解决方案正如上面的分析，不过其实上面的解决方案无论GET还是POST都通用的。只不过<strong>对于POST请求参数一般都会比较多，采用这种方式解决乱码起来比较麻烦，所以对于POST请求还是建议使用设置编码的方式进行。</strong> 因为POST请求是以流对象传输的，服务器接收POST请求数据的时候是用getReader()获取的所以我们只需设置输入流的编码为UTF-8即可。而GET请求不能通过设置流编码的方式就是因为GET获取参数的方式：getQueryString()并没有走流。</p></div><div><p>另外需要说明一点的是<mark>Tomcat8.0之后，已将GET请求乱码问题解决，设置默认的解码方式为UTF-8</mark></p></div><div><p><strong>小结</strong></p></div><div><ol>
<li data-line="0">中文乱码解决方案</li>
</ol></div><div><ul>
<li data-line="0">
<p>POST请求和GET请求的参数中如果有中文，后台接收数据就会出现中文乱码问题</p>
<p>GET请求在Tomcat8.0以后的版本就不会出现了</p>
</li>
<li data-line="4">
<p>POST请求解决方案是:设置输入流的编码</p>
<pre><code>request.setCharacterEncoding("UTF-8");
注意:设置的字符集要和页面保持一致
</code><button class="copy-code-button">复制</button></pre>
</li>
<li data-line="11">
<p>通用方式（GET/POST）：需要先解码，再编码</p>
<pre><code>new String(username.getBytes("ISO-8859-1"),"UTF-8");
</code><button class="copy-code-button">复制</button></pre>
</li>
</ul></div><div><ol start="2">
<li data-line="0">URL编码实现方式:</li>
</ol></div><div><ul>
<li data-line="0">
<p>编码:</p>
<pre><code>URLEncoder.encode(str,"UTF-8");
</code><button class="copy-code-button">复制</button></pre>
</li>
<li data-line="6">
<p>解码:</p>
<pre><code>URLDecoder.decode(s,"ISO-8859-1");
</code><button class="copy-code-button">复制</button></pre>
</li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="Request请求转发" class="heading" id="Request请求转发"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Request请求转发</h4><div class="heading-children"><div><p><mark>请求转发(forward):一种在服务器内部的资源跳转方式。</mark></p></div><div><p>(1)浏览器发送请求给服务器，服务器中对应的资源A接收到请求</p></div><div><p>(2)资源A处理完请求后将请求发给资源B</p></div><div><p>(3)资源B处理完后将结果响应给浏览器</p></div><div><p>(4)请求从资源A到资源B的过程就叫<mark>请求转发</mark></p></div><div><p><strong>为什么呢？我们需要流水线一般的作业，先交由你处理数据再将处理好的数据转发给上级继续处理的思想</strong></p></div><div><p>请求转发的实现方式:</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded">req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"资源B路径"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p><mark>请求转发资源间共享数据:使用Request对象</mark></p></div><div><p>此处主要解决的问题是把请求从<code>/req5</code>转发到<code>/req6</code>的时候，如何传递数据给<code>/req6</code>。</p></div><div><p>需要使用request对象提供的三个方法:</p></div><div><ul>
<li data-line="0">
<p>存储数据到request域[范围,数据是存储在request对象中</p>
<pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token keyword">void</span> <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">复制</button></pre>
</li>
<li data-line="6">
<p>根据key获取值</p>
<pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token class-name">Object</span> <span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">复制</button></pre>
</li>
<li data-line="12">
<p>根据key删除该键值对</p>
<pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token keyword">void</span> <span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">复制</button></pre>
</li>
</ul></div><div><p><strong>接着上个需求案例</strong></p></div><div><p><img src="https://pic.imgdb.cn/item/631b34d516f2c2beb1dcd5c7.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><blockquote>
<p>1.在RequestDemo5的doGet方法中转发请求之前，将数据存入request域对象中</p>
<p>2.在RequestDemo6的doGet方法从request域对象中获取数据，并将数据打印到控制台</p>
<p>3.启动访问测试</p>
</blockquote></div><div><p>(1)RequestDemo5</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/req5"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestDemo5</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"demo5..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//存储数据</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//请求转发</span>
        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/req6"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>(2)修改RequestDemo6</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token doc-comment comment">/**
 * 请求转发
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/req6"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestDemo6</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"demo6..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取数据</span>
        <span class="token class-name">Object</span> msg <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>(3)启动测试</p></div><div><p>访问<code>http://localhost:8080/request-demo/req5</code>,就可以在控制台看到数据被转发，实现在转发多个资源之间共享数据。</p></div><div><p><strong>请求转发的特点</strong></p></div><div><ul>
<li data-line="0">
<p>浏览器地址栏路径不发生变化</p>
<p>虽然后台从<code>/req5</code>转发到<code>/req6</code>,但是浏览器的地址一直是<code>/req5</code>,未发生变化</p>
</li>
<li data-line="4">
<p>只能转发到当前服务器的内部资源</p>
<p>不能从一个服务器通过转发访问另一台服务器</p>
</li>
<li data-line="8">
<p>一次请求，可以在转发资源间使用request共享数据</p>
<p>虽然后台从<code>/req5</code>转发到<code>/req6</code>，但是这个<mark>只有一次请求</mark>（客户端只发出了一次请求）</p>
</li>
</ul></div><div><p><strong>正因为请求转发是一次请求所以才能使用Request域对象存储数据，因为Request的作用范围就是一次请求，共用一个Request对象</strong></p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="Response对象" class="heading" id="Response对象"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Response对象</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="Response继承体系" class="heading" id="Response继承体系"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Response继承体系</h4><div class="heading-children"><div><ul>
<li data-line="0">Request:使用request对象来<mark>获取</mark>请求数据</li>
<li data-line="1">Response:使用response对象来<mark>设置</mark>响应数据</li>
</ul></div><div><p>它的继承体系和Request类似，如图示：</p></div><div><p><img src="https://pic.imgdb.cn/item/631bea6c16f2c2beb1839102.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="Response设置响应数据" class="heading" id="Response设置响应数据"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Response设置响应数据</h4><div class="heading-children"><div><p>HTTP响应数据总共分为三部分内容，分别是<mark>响应行、响应头、响应体</mark>，对于这三部分内容的数据，respone对象都提供了相应方法设置</p></div><div><ol>
<li data-line="0">响应行</li>
</ol></div><div><p><img src="https://pic.imgdb.cn/item/631bebf916f2c2beb184ce68.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>对于响应行，比较常用的就是<strong>设置响应状态码:</strong></p></div><div><pre><code>void setStatus(int sc);
</code><button class="copy-code-button">复制</button></pre></div><div><ol start="2">
<li data-line="0">响应头</li>
</ol></div><div><p><img src="https://pic.imgdb.cn/item/631bec0a16f2c2beb184dcc2.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>设置响应头键值对：</strong></p></div><div><pre><code>void setHeader(String name,String value);
</code><button class="copy-code-button">复制</button></pre></div><div><ol start="3">
<li data-line="0">响应体</li>
</ol></div><div><p><img src="https://pic.imgdb.cn/item/631bec1916f2c2beb184e980.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>对于响应体，是通过字符、字节输出流的方式往浏览器写，</p></div><div><p><strong>获取字符输出流:</strong></p></div><div><pre><code>PrintWriter getWriter();
</code><button class="copy-code-button">复制</button></pre></div><div><p><strong>获取字节输出流</strong></p></div><div><pre><code>ServletOutputStream getOutputStream();
</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="Respones请求重定向" class="heading" id="Respones请求重定向"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Respones请求重定向</h4><div class="heading-children"><div><p>——概念——</p></div><div><p><img src="https://pic.imgdb.cn/item/631bed3316f2c2beb185c794.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>（1）分步走</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded">        <span class="token comment">//重定向</span>
        <span class="token comment">//1.设置响应状态码 302</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. 设置响应头 Location</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Location"</span><span class="token punctuation">,</span><span class="token string">"/request-demo/resp2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>（2）重定向简化</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded">        <span class="token comment">//重定向</span>
        resposne<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/request-demo/resp2"</span><span class="token punctuation">)</span>；
</code><button class="copy-code-button">复制</button></pre></div><div><p>（3）重定向的特点</p></div><div><ul>
<li data-line="0">
<p>浏览器地址栏路径发送变化</p>
<p>当进行重定向访问的时候，由于是由浏览器发送的两次请求，所以地址会发生变化</p>
</li>
<li data-line="4">
<p>可以重定向到任何位置的资源(服务内容、外部均可)</p>
<p>因为第一次响应结果中包含了浏览器下次要跳转的路径，所以这个路径是可以任意位置资源。</p>
</li>
<li data-line="8">
<p>两次请求，不能在多个资源使用request共享数据</p>
<p>因为浏览器发送了两次请求，是两个不同的request对象，就无法通过request对象进行共享数据</p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="Response响应字符数据" class="heading" id="Response响应字符数据"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Response响应字符数据</h4><div class="heading-children"><div><p>要想将字符数据写回到浏览器，我们需要两个步骤:</p></div><div><ul>
<li data-line="0">
<p>通过Response对象获取字符输出流： PrintWriter writer = resp.getWriter();</p>
</li>
<li data-line="2">
<p>通过字符输出流写数据: writer.write("aaa");</p>
</li>
</ul></div><div><p>接下来，我们实现通过些案例把响应字符数据给实际应用下:</p></div><div><ol>
<li data-line="0">返回一个简单的字符串<code>aaa</code></li>
</ol></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token doc-comment comment">/**
 * 响应字符数据：设置字符数据的响应体
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/resp3"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseDemo3</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1. 获取字符输出流</span>
        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><ol start="2">
<li data-line="0">返回一串html字符串，并且能被浏览器解析</li>
</ol></div><div><pre><code>PrintWriter writer = response.getWriter();
//content-type，告诉浏览器返回的数据类型是HTML类型数据，这样浏览器才会解析HTML标签
response.setHeader("content-type","text/html");
writer.write("&lt;h1&gt;aaa&lt;/h1&gt;");
</code><button class="copy-code-button">复制</button></pre></div><div><p><mark>注意:</mark>一次请求响应结束后，response对象就会被销毁掉，所以不要手动关闭流。</p></div><div><ol start="3">
<li data-line="0"><strong>返回一个中文的字符串<code>你好</code>，需要注意设置响应数据的编码为<code>utf-8</code></strong></li>
</ol></div><div><pre><code>//设置响应的数据格式及数据的编码
response.setContentType("text/html;charset=utf-8");
writer.write("你好");
</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="Response响应字节数据" class="heading" id="Response响应字节数据"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Response响应字节数据</h4><div class="heading-children"><div><p>要想将字节数据写回到浏览器，我们需要两个步骤:</p></div><div><ul>
<li data-line="0">
<p>通过Response对象获取字节输出流：ServletOutputStream outputStream = resp.getOutputStream();</p>
</li>
<li data-line="2">
<p>通过字节输出流写数据: outputStream.write(字节数据);</p>
</li>
</ul></div><div><p>接下来，我们实现通过些案例把响应字符数据给实际应用下:</p></div><div><ol>
<li data-line="0">返回一个图片文件到浏览器</li>
</ol></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token doc-comment comment">/**
 * 响应字节数据：设置字节数据的响应体
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/resp4"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseDemo4</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. 读取文件</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"d://a.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. 获取response字节输出流</span>
        <span class="token class-name">ServletOutputStream</span> os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3. 完成流的copy</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>上述代码中，对于流的copy的代码还是比较复杂的，所以我们可以使用别人提供好的方法来简化代码的开发，具体的步骤是:</p></div><div><p>(1)pom.xml添加依赖</p></div><div><pre class="language-xml" tabindex="0"><code class="language-xml is-loaded"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>(2)调用工具类方法</p></div><div><pre><code>//fis:输入流
//os:输出流
IOUtils.copy(fis,os);
</code><button class="copy-code-button">复制</button></pre></div><div><p>优化后的代码:</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token doc-comment comment">/**
 * 响应字节数据：设置字节数据的响应体
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/resp4"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseDemo4</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. 读取文件</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"d://a.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. 获取response字节输出流</span>
        <span class="token class-name">ServletOutputStream</span> os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3. 完成流的copy</span>
      	<span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="资源路径问题" class="heading" id="资源路径问题"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>资源路径问题</h2><div class="heading-children"><div><p><strong>问题1</strong></p></div><div><p>转发的时候路径上没有加<code>/request-demo</code>而重定向加了，那么到底什么时候需要加，什么时候不需要加呢?</p></div><div><p><img src="https://pic.imgdb.cn/item/631bedd216f2c2beb1864ea6.jpg" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>其实判断的依据很简单，只需要记住下面的规则即可:</p></div><div><ul>
<li data-line="0">浏览器使用:需要加虚拟目录(项目访问路径)</li>
<li data-line="1">服务端使用:不需要加虚拟目录</li>
</ul></div><div><p>对于转发来说，因为是<strong>在服务端进行的，所以不需要加虚拟目录</strong></p></div><div><p>对于重定向来说，路径最终是<strong>由浏览器来发送请求，就需要添加虚拟目录。</strong></p></div><div><p>掌握了这个规则，接下来就通过一些练习来强化下知识的学习:</p></div><div><ul>
<li data-line="0"><code>&lt;a href='路劲'&gt;</code></li>
<li data-line="1"><code>&lt;form action='路径'&gt;</code></li>
<li data-line="2">req.getRequestDispatcher("路径")</li>
<li data-line="3">resp.sendRedirect("路径")</li>
</ul></div><div><p>答案:</p></div><div><pre><code>1.超链接，从浏览器发送，需要加
2.表单，从浏览器发送，需要加
3.转发，是从服务器内部跳转，不需要加
4.重定向，是由浏览器进行跳转，需要加。
</code><button class="copy-code-button">复制</button></pre></div><div><p><strong>问题2</strong></p></div><div><p>在重定向的代码中，<code>/request-demo</code>是固定编码的，如果后期通过Tomcat插件配置了项目的访问路径，那么所有需要重定向的地方都需要重新修改，该如何优化?<br>
<img alt="image-20240311110126722" src="https://i0.hdslb.com/bfs/article/f887b9a438d3eb49f17660a39d667a69688545001.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"><br>
答案也比较简单，我们可以在<strong>代码中动态去获取项目访问的虚拟目录</strong>，具体如何获取，我们可以借助前面咱们所学习的<strong>request对象中的getContextPath()方法</strong>，修改后的代码如下:</p></div><div><pre class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/resp1"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseDemo1</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"resp1...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//简化方式完成重定向</span>
        <span class="token comment">//动态获取虚拟目录</span>
        <span class="token class-name">String</span> contextPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>contextPath<span class="token operator">+</span><span class="token string">"/resp2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button">复制</button></pre></div><div><p>动态获取项目访问的虚拟路径，从而降低代码的耦合度。</p></div><div class="mod-footer"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="outline-tree tree-container"><div class="tree-item nav-folder mod-root" data-depth="0"><div class="tree-item-self nav-folder-title"><div class="tree-item-inner nav-folder-title-content">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item-children nav-folder-children"><div class="nav-folder-spacer"></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#HTTP域对象" data-path="#HTTP域对象"><div class="tree-item-inner heading-link" heading-name="HTTP域对象">HTTP域对象</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#什么是HTTP" data-path="#什么是HTTP"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="什么是HTTP">什么是HTTP</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#概念" data-path="#概念"><div class="tree-item-inner heading-link" heading-name="概念">概念</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#请求数据格式" data-path="#请求数据格式"><div class="tree-item-inner heading-link" heading-name="请求数据格式">请求数据格式</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#响应数据格式" data-path="#响应数据格式"><div class="tree-item-inner heading-link" heading-name="响应数据格式">响应数据格式</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#请求域对象" data-path="#请求域对象"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="请求域对象">请求域对象</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#什么是请求域对象" data-path="#什么是请求域对象"><div class="tree-item-inner heading-link" heading-name="什么是请求域对象">什么是请求域对象</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Request对象" data-path="#Request对象"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Request对象">Request对象</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Request继承体系" data-path="#Request继承体系"><div class="tree-item-inner heading-link" heading-name="Request继承体系">Request继承体系</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Request获取请求数据" data-path="#Request获取请求数据"><div class="tree-item-inner heading-link" heading-name="Request获取请求数据">Request获取请求数据</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Request通用方式获取请求参数【√】" data-path="#Request通用方式获取请求参数【√】"><div class="tree-item-inner heading-link" heading-name="Request通用方式获取请求参数【√】">Request通用方式获取请求参数【√】</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#IDEA模板创建Servlet" data-path="#IDEA模板创建Servlet"><div class="tree-item-inner heading-link" heading-name="IDEA模板创建Servlet">IDEA模板创建Servlet</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#请求参数中文乱码问题" data-path="#请求参数中文乱码问题"><div class="tree-item-inner heading-link" heading-name="请求参数中文乱码问题">请求参数中文乱码问题</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Request请求转发" data-path="#Request请求转发"><div class="tree-item-inner heading-link" heading-name="Request请求转发">Request请求转发</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Response对象" data-path="#Response对象"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Response对象">Response对象</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Response继承体系" data-path="#Response继承体系"><div class="tree-item-inner heading-link" heading-name="Response继承体系">Response继承体系</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Response设置响应数据" data-path="#Response设置响应数据"><div class="tree-item-inner heading-link" heading-name="Response设置响应数据">Response设置响应数据</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Respones请求重定向" data-path="#Respones请求重定向"><div class="tree-item-inner heading-link" heading-name="Respones请求重定向">Respones请求重定向</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Response响应字符数据" data-path="#Response响应字符数据"><div class="tree-item-inner heading-link" heading-name="Response响应字符数据">Response响应字符数据</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#Response响应字节数据" data-path="#Response响应字节数据"><div class="tree-item-inner heading-link" heading-name="Response响应字节数据">Response响应字节数据</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="技术/后端/java/http域对象.html#资源路径问题" data-path="#资源路径问题"><div class="tree-item-inner heading-link" heading-name="资源路径问题">资源路径问题</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>