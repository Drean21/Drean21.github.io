<!DOCTYPE html>
<html><head>
<title>微服务治理</title>
<base href="../../..">
<meta id="root-path" root-path="../../..">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
<meta charset="UTF-8">
<meta name="description" content="尘影迹痕 - 微服务治理">
<meta property="og:title" content="微服务治理">
<meta property="og:description" content="尘影迹痕 - 微服务治理">
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.cytl2.eu.org/技术/后端/java/微服务治理.html">
<meta property="og:image" content="https://i0.hdslb.com/bfs/album/802d43a635ba2730810aae40461bd63c1f01b469.png">
<meta property="og:site_name" content="尘影迹痕">
<meta name="author" content="lzy"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://blog.cytl2.eu.org/lib/rss.xml"></head><body class="publish css-settings-manager theme-light show-inline-title h2-underline tbMH-yuan tbMH-qk tbMH-ds-cg tbMH-kd-ncc-jy is-focused"><include src="lib/html/custom-head-content.html"></include><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.svg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(const t of e){let e=t.getAttribute("src");try{const o=await fetch(e);if(!o.ok){console.log("Could not include file: "+e),t?.remove();continue}let l=await o.text(),n=document.createRange().createContextualFragment(l),c=Array.from(n.children);for(let e of c)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);t.before(n),t.remove(),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="SpringCloud"><p>SpringCloud</p></h1><div class="heading-wrapper"><div class="heading-children"><div><p>微服务框架（其实由很多公司开源出来的组件收录整合而成），基于SpringBoot自动装配的特性，SpringBoot也实现了微服务的整合，如此才容易得到推广。</p></div><div><p><img alt="image-20230116195322399" src="https://i0.hdslb.com/bfs/album/802d43a635ba2730810aae40461bd63c1f01b469.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>组件</strong></p></div><div><ul>
<li data-line="0">注册中心</li>
<li data-line="1">负载均衡器Ribbon</li>
</ul></div><div><p><strong>版本兼容问题</strong></p></div><div><p>SpringCloud要使用必须保证有与之匹配的SpringBoot版本（官网查阅）</p></div><div><p>像Hoxton.SR10大于SR5，则Hoxton对应SpringBoot版本2.3.X。否则不兼容报错</p></div><div><p><img alt="image-20230116195925968" src="https://i0.hdslb.com/bfs/album/d8bc4492e02fc1afc1eb35d925dff102fa72aa07.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div class="heading-wrapper"><h2 data-heading="一、服务拆分" class="heading" id="一、服务拆分"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>一、服务拆分</h2><div class="heading-children"><div><p><mark>微服务治理的服务拆分包括注册发现、远程调用、配置管理</mark></p></div><div class="heading-wrapper"><h3 data-heading="1、微服务事项" class="heading" id="1、微服务事项"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1、微服务事项</h3><div class="heading-children"><div><ul>
<li data-line="0">根据业务模块拆分（当然一个模块还可以继续拆分更细），做到单一职责，不要重复开发相同业务</li>
<li data-line="1">微服务数据独立，不要访问其他微服务的数据库</li>
<li data-line="2">微服务可以将业务暴露为接口，供其它微服务使用</li>
</ul></div><div><p><img alt="image-20230116201715272" src="https://i0.hdslb.com/bfs/album/e6eda036155dd4a4d7946a76fabb5df0db1addf4.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h3 data-heading="2、微服务项目结构" class="heading" id="2、微服务项目结构"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2、微服务项目结构</h3><div class="heading-children"><div><p><img alt="image-20230116201259749" src="https://i0.hdslb.com/bfs/album/2216ceecd868f088dae05fa6d7dbdcd9a2aca23f.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h3 data-heading="3、微服务远程调用" class="heading" id="3、微服务远程调用"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3、微服务远程调用</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="远程调用原理" class="heading" id="远程调用原理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>远程调用原理</h4><div class="heading-children"><div><ul>
<li data-line="0">基于RestTemplate发起的http请求实现远程调用</li>
<li data-line="1">http请求做远程调用是与语言无关的调用，只要知道对方的ip、端口、接口路径、请求参数即可（类比前端发送Ajax请求）</li>
<li data-line="2"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>服务调用关系
<ul>
<li data-line="3">服务提供者：暴露接口给其他微服务调用</li>
<li data-line="4">服务消费者：调用其它微服务提供的接口</li>
<li data-line="5">一个服务可以同时是服务提供者和服务消费者——&gt;角色相对</li>
</ul>
</li>
</ul></div><div><p><img alt="image-200116202708561" src="https://i0.hdslb.com/bfs/album/3fb686d1f56107ea83b4593b6f1997da975d6060.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="基于Feign的远程调用" class="heading" id="基于Feign的远程调用"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>基于Feign的远程调用</h4><div class="heading-children"><div><p>声明式的http请求调用客户端，而且内部实现了负载均衡</p></div><div><p><img alt="image-20230117134053060" src="https://i0.hdslb.com/bfs/album/d7b27970c748119a37e768bfe2c72048e6ad410b.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><blockquote>
<p>声明式：只需要一个注解声明就能实现功能，类比注解开启事务</p>
</blockquote></div><div class="heading-wrapper"><h5 data-heading="基本使用" class="heading" id="基本使用"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>基本使用</h5><div class="heading-children"><div><p>引入依赖</p></div><div><p><img alt="image-20230117133613213" src="https://i0.hdslb.com/bfs/album/93e55595c55de5d4fac52253440976e3bcc3c311.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>添加@EnableFeignClients注解</p></div><div><p><img alt="image-20230117133642543" src="https://i0.hdslb.com/bfs/album/93e55595c55de5d4fac52253440976e3bcc3c311.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>编写FeignClient接口</p></div><div><p><img alt="image-20230117133819806" src="https://i0.hdslb.com/bfs/album/9b59fbd71095039e7ea52dd9140860dc4874e593.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>使用FeignClient中定义的方法代替RestTemplate</p></div><div><p><img alt="image-20230117133901439" src="https://i0.hdslb.com/bfs/album/d548caf867b6d8c434aa89e0f667ed727aacb5a1.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="自定义配置" class="heading" id="自定义配置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>自定义配置</h5><div class="heading-children"><div><p>SpringBoot能够自动装配，但是呢也能允许我们覆盖重写一些“对象”的配置。</p></div><div><p>对于Feign来说可以修改的配置主要是以下内容：<img alt="image-20230117135112759" src="https://i0.hdslb.com/bfs/album/ea2321266bd42628365bd154cb67c1a561efa6ef.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>一般是配置日志</strong>，其他的没啥必要，而且记录日志也是要消耗性能的，所以一般都是将日志等级设置为basic或者null</p></div><div><p>修改配置的方法有两种：</p></div><div><ul>
<li data-line="0">方式一是配置文件，feign.client.config.xxx.loggerLevel<br>
①如果xxx是default则代表全局<br>
②如果xxx是服务名称，例如userservice则代表某服务</li>
<li data-line="3">方式二是java代码配置Logger.Level这个Bean<br>
①如果在@EnableFeignClients注解声明则代表全局</li>
<li data-line="5">②如果在@FeignClient注解中声明则代表某服务</li>
</ul></div><div><p><img alt="image-20230117134837425" src="https://i0.hdslb.com/bfs/album/ec21d7e06fc6a59a1dbae58dc92206527ce13e5b.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="性能优化" class="heading" id="性能优化"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>性能优化</h5><div class="heading-children"><div><p><strong>①为什么需要性能优化</strong></p></div><div><p>Feign底层发送http请求的客户端实现:</p></div><div><ul>
<li data-line="0">
<p>URLConnection:默认实现（jdk），不支持连接池.</p>
</li>
<li data-line="1">
<p>Apache HttpClient:支持连接池（Spring的默认实现）</p>
</li>
<li data-line="3">
<p>OKHttp:支持连接池</p>
</li>
</ul></div><div><p>因此优化Feign的性能主要包括:</p></div><div><ul>
<li data-line="0">使用连接池代替默认的URLConnection</li>
<li data-line="1">日志级别，最好用basic或none</li>
</ul></div><div><p>完成性能优化一般修改配置后需要进行压测来确定具体的数值设定</p></div><div><p><strong>②案例：Feign添加HttpClient的支持</strong></p></div><div><ul>
<li data-line="0">pom.xml引入依赖</li>
<li data-line="1"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>application.yml配置连接池
<ul>
<li data-line="2">最大连接数</li>
<li data-line="3">单个路径的最大连接数</li>
<li data-line="4">......</li>
</ul>
</li>
</ul></div><div><p><img alt="image-20230117140317017" src="https://i0.hdslb.com/bfs/album/7160a5f9f5414e1296d02ae7fdfc938e6d1cefec.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="Feign的最佳实践" class="heading" id="Feign的最佳实践"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Feign的最佳实践</h5><div class="heading-children"><div><p>所谓最佳实践就是大量公司企业在不断踩坑的情形下经验积累出使用Feign的最佳开发方案</p></div><div class="heading-wrapper"><h6 data-heading="1）分析" class="heading" id="1）分析"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1）分析</h6><div class="heading-children"><div><ul>
<li data-line="0"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>【继承】让controller和FeignClient继承同一接口</p>
<ul>
<li data-line="2">服务紧耦合。但更具“契约性”。</li>
<li data-line="3">父接口参数列表中的映射不会被继承——&gt;需要在Controller中实现方法</li>
</ul>
<p><img alt="image-20230117142836201" src="https://i0.hdslb.com/bfs/album/607a7349f1e3ba96291942766f13ca38f2f26722.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
<li data-line="7">
<p>【抽取/封装】将FeignClient、POJO、Feign的默认配置都定义到一个项目中，供所有消费者使用</p>
<p>冗余度高，如果抽取东西过多，其它一个小业务模块就会引入很多不相关的东西。但更为规范。</p>
<p><img alt="image-20230117143409964" src="https://i0.hdslb.com/bfs/album/c85295fb4fdf7764f30792a9e6ebb51a2b207a3e.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h6 data-heading="2）实践" class="heading" id="2）实践"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2）实践</h6><div class="heading-children"><div><p><strong>流程总结</strong></p></div><div><p>实现最佳实践方式二的步骤如下:<br>
1．首先创建一个module，命名为feign-api，然后引入feign的starter依赖<br>
2．将order-service中编写的UserClient、User、DefaultFeignConfiguration都复制到feign-api项目中</p></div><div><p>3．在order-service中引入feign-api的依赖<br>
4．修改order-service中的所有与上述三个组件有关的import部分，改成导入feign-api中的包</p></div><div><p>5．重启测试</p></div><div><p><strong>步骤实现</strong></p></div><div><p>1．首先创建一个module，命名为feign-api，然后引入feign的starter依赖<img alt="image-20230117144939208" src="https://i0.hdslb.com/bfs/album/1a5b8c93ba41cee799e77891b815b535f65695e3.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>2．将order-service中编写的UserClient、User、DefaultFeignConfiguration都复制到feign-api项目中</p></div><div><p><img alt="image-20230117145213525" src="https://i0.hdslb.com/bfs/album/c3659031d5170bc0e197415acf02d2bbe8825370.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>3．在order-service中引入feign-api的依赖</p></div><div><p><img alt="image-20230117145453670" src="https://i0.hdslb.com/bfs/album/e383eaf44662396b978961b0e553c70fdf447922.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>4．修改order-service中的所有与上述三个组件有关的import部分，改成导入feign-api中的包</p></div><div><p><strong>5、注意事项，指定扫描</strong></p></div><div><p><strong>当定义的FeignClient不在SpringBootApplication的扫描包范围时，这些FeignClient无法使用。</strong> 即SpringBoot默认只在自己的应用范围内扫描包（只有扫描到而且扫描到类上有交付处理的注解才会被SpringBoot当成Bean进行管理，这样才能在调用处正确自动装配）</p></div><div><p>有两种方式解决:</p></div><div><ul>
<li data-line="0">
<p>方式一:指定Feignclient所在包</p>
</li>
<li data-line="2">
<p><strong>方式二:指定FeignClient字节码（用到才导（数组）指定加载的客户端无需扩大包扫描的范围）</strong> ✔️</p>
</li>
</ul></div><div><p><img alt="image-20230117150333828" src="https://i0.hdslb.com/bfs/album/0c8645b815315c2dafe82e8c480f98b099ef2b6b.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>方式二案例：</p></div><div><p><img alt="image-20230117145839012" src="https://i0.hdslb.com/bfs/album/f5ed04831e88c72750fdfca4fccf474dc1d390ae.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div></div></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="4、Eureka架构【注册/监控】⭐️" class="heading" id="4、Eureka架构【注册/监控】⭐️"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4、Eureka架构【注册/监控】⭐️</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="概念原理" class="heading" id="概念原理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>概念原理</h4><div class="heading-children"><div><p>在Eureka架构中，微服务角色有两类：</p></div><div><ul>
<li data-line="0"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>EurekaServer：服务端，注册中心
<ul>
<li data-line="1">记录服务信息</li>
<li data-line="2">心跳监控</li>
</ul>
</li>
<li data-line="3"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>EurekaClient：客户端
<ul>
<li data-line="4"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Provider：服务提供者
<ul>
<li data-line="5">注册自己的信息到EurekaServer</li>
<li data-line="6">每隔30s向EurekaServer发送心跳</li>
</ul>
</li>
<li data-line="7"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>consumer：服务消费者
<ul>
<li data-line="8">根据名称从EurekaServer拉取服务列表</li>
<li data-line="9">基于服务列表做<strong>负载均衡</strong>，选中一个微服务后发起远程调用【多个服务提供者，消费者如何选择】</li>
</ul>
</li>
</ul>
</li>
</ul></div><div><p>架构图：</p></div><div><p><img alt="image-20230116203754142" src="https://i0.hdslb.com/bfs/album/3b62e706a55336eb790bbca136951229655801ec.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="搭建Eureka" class="heading" id="搭建Eureka"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>搭建Eureka</h4><div class="heading-children"><div><ul>
<li data-line="0">创建项目，引入spring-cloud-starter-netflix-eureka-server依赖</li>
<li data-line="1">编写启动类，添加@EnableEurekaServer注解</li>
<li data-line="2"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>添加application.yml文件
<ul>
<li data-line="3">设置服务端口</li>
<li data-line="4">设置服务名称</li>
<li data-line="5">设置服务接口接口（当Eureka集群存在时，用来相互注册）</li>
</ul>
</li>
</ul></div><div><p><img alt="image-20230116205222367" src="https://i0.hdslb.com/bfs/album/bf80bd8581816696dd202bedaa5329a5db397a09.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="服务注册" class="heading" id="服务注册"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>服务注册</h4><div class="heading-children"><div><p>在客户端（<strong>相对</strong>）</p></div><div><ul>
<li data-line="0">引入eureka-client依赖</li>
<li data-line="1">在application.yml中配置eureka地址——&gt;只要知道eureka地址都可以注册</li>
</ul></div><div><blockquote>
<p>IDEA模拟多实例注册：右键选择复制一份配置然后并在窗口中选择命令行添加<code>-DServer.port=未被使用的端口</code>来启动。-D表示添加命令行参数。</p>
</blockquote></div></div></div><div class="heading-wrapper"><h4 data-heading="服务发现" class="heading" id="服务发现"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>服务发现</h4><div class="heading-children"><div><p>服务拉取是基于服务名称获取服务列表，然后再对服务器列表做负载均衡</p></div><div><p><img alt="image-20230116211355710" src="https://i0.hdslb.com/bfs/album/2e6c1437a6619eda7ecdfddf418de3986dc1884e.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="流程总结" class="heading" id="流程总结"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>流程总结</h4><div class="heading-children"><div><p><img alt="image-20230116211302941" src="https://i0.hdslb.com/bfs/album/6b7eafe35cb741e222f1db2726cf9565536d7b75.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="负载均衡原理及策略更改" class="heading" id="负载均衡原理及策略更改"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>负载均衡原理及策略更改</h4><div class="heading-children"><div class="heading-wrapper"><h5 data-heading="负载均衡流程（负载均衡器Ribbon）⭐️" class="heading" id="负载均衡流程（负载均衡器Ribbon）⭐️"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>负载均衡流程（负载均衡器Ribbon）⭐️</h5><div class="heading-children"><div><p>主要由IRule接口定义负载均衡的选择（内含随机等各种算法）</p></div><div><p><img alt="image-20230116213300581" src="https://i0.hdslb.com/bfs/album/ca84719aa467d500351d77988a6e20df20bc7a47.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="负载均衡策略" class="heading" id="负载均衡策略"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>负载均衡策略</h5><div class="heading-children"><div><p><mark>Ribbon的负载均衡规则是一个叫做IRule的接口来定义的，每一个子接口都是一种规则</mark></p></div><div><p>默认选择实现的是zoneAvoidanceRule这个类——&gt;通过配置类修改选择均衡的策略</p></div><div><p><img alt="image-20230116214245290" src="https://i0.hdslb.com/bfs/album/b4a3381ed2e42dff9194873b1c42de15acba979a.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>策略含义</strong></p></div><div><p><img alt="image-20230116214151816" src="https://i0.hdslb.com/bfs/album/b2c4033d6b8fa9ebc10dcf20e9e8bb88abb59f71.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="更改负载均衡策略" class="heading" id="更改负载均衡策略"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>更改负载均衡策略</h5><div class="heading-children"><div><p>有两种</p></div><div><ul>
<li data-line="0">代码配置类设置（全局）——&gt;定义新的IRule</li>
<li data-line="1">针对单个微服务进行配置——&gt;单个微服务的配置文件添加ribbon下的NFLoadBalancerRuleClassName字段属性设置包路径</li>
</ul></div><div><p><img alt="image-20230116214429839" src="https://i0.hdslb.com/bfs/album/bd9fef725be9b97333b61741d5c24903b307e2df.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="饥饿加载" class="heading" id="饥饿加载"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>饥饿加载</h5><div class="heading-children"><div><p>Ribbon默认是采用<strong>懒加载</strong>，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。</p></div><div><p>而<strong>饥饿加载</strong>则会在项目启动时创建，降低第一次访问的耗时，通过修改配置文件ribbon-eager-load-enabled：true设置为开启饥饿加载</p></div><div><p><img alt="image-20230116215518155" src="https://i0.hdslb.com/bfs/album/37a174a979e038e4b857957792c6f9474929fea3.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="总结" class="heading" id="总结"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>总结</h5><div class="heading-children"><div><p><img alt="image-20230116215401673" src="https://i0.hdslb.com/bfs/album/2171f33856059ae88f55485fdd6d5c3fa8612dbb.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="5、Nacos架构【注册/监控/集群/环境隔离】⭐️" class="heading" id="5、Nacos架构【注册/监控/集群/环境隔离】⭐️"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5、Nacos架构【注册/监控/集群/环境隔离】⭐️</h3><div class="heading-children"><div><p>阿里巴巴提供的，比Eureka更为丰富（多出了集群概念），它并没有内嵌到SpringCloud中，需要<strong>单独安装和启动</strong></p></div><div><p>Nacos遵循SpringCloud接口的开发规范——&gt;<strong>服务注册</strong>和Eureka类似——&gt;只需改依赖就行（区分服务端和客户端依赖）</p></div><div><pre class="language-shell" tabindex="0"><code class="language-shell is-loaded">startup.cmd -m standalone
</code><button class="copy-code-button">复制</button></pre></div><div><p>因为Nacos默认是集群启动，所以如果想要单个启动需要加上其余参数，如上</p></div><div><p><img alt="image-20230116221611013" src="https://i0.hdslb.com/bfs/album/4e4c8c286c49383b565acb5b41a862afd06babb7.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div class="heading-wrapper"><h4 data-heading="服务多级存储模型【地域访问/容灾】" class="heading" id="服务多级存储模型【地域访问/容灾】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>服务多级存储模型【地域访问/容灾】</h4><div class="heading-children"><div><p>分三级</p></div><div><ul>
<li data-line="0">服务</li>
<li data-line="1">集群</li>
<li data-line="2">实例</li>
</ul></div><div><p><strong>模型抽象图</strong></p></div><div><p>服务调用尽可能选择本地集群的服务，跨集群调用延迟较高本地集群不可访问时，再去访问其它集群</p></div><div><p><img alt="image-20230116222718075" src="https://i0.hdslb.com/bfs/album/a1600e40c5b1bf6d5f9226b11c340e563aa7a4cf.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>配置集群</strong></p></div><div><p>在配置文件中添加spring.cloud.nacos.discovery.cluster-name属性</p></div><div><p><img alt="image-20230116222547821" src="https://i0.hdslb.com/bfs/album/5d277b09332896726e1f8d2afa822f58d1bfc751.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="NacosRule的负载均衡" class="heading" id="NacosRule的负载均衡"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>NacosRule的负载均衡</h4><div class="heading-children"><div><p>和Eureka一样基于IRule接口实现负载均衡策略，设置均衡策略方式一样是通过修改配置属性</p></div><div><p><img alt="image-20230117100110441" src="https://i0.hdslb.com/bfs/album/3f6ec18990e5904ba42be17db4a2cf8d9f9da44c.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>和Eureka不一样的是Eureka有一个专门的策略NacosRule负载均衡策略</p></div><div><ul>
<li data-line="0">优先选择同集群服务实例列表</li>
<li data-line="1">本地集群找不到提供者，才去其它集群寻找，并且会报警告</li>
<li data-line="2">确定了可用实例列表后，再采用随机负载均衡挑选实例</li>
</ul></div><div><p><img alt="image-20230117095755503" src="https://i0.hdslb.com/bfs/album/594981d592d0d4088971295453550ca15b7cb903.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="服务实例的权重设置" class="heading" id="服务实例的权重设置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>服务实例的权重设置</h4><div class="heading-children"><div><p>NacaosRule默认就是按集群选择实例列表然后随机选择，但是如果一个集群里边的实例有些老机器和新机器，自然希望老机器的访问量少一点新机器访问量多一点来分担压力——&gt;解决方案：权重设置</p></div><div><ul>
<li data-line="0"><strong>Nacos控制台</strong>可以设置实例的权重值，0~1之间同集群内的多个实例，</li>
<li data-line="1">权重越高被访问的频率越高</li>
<li data-line="2"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><mark>权重设置为0则完全不会被访问——&gt;系统的平滑升级，用户无感知</mark>
<ul>
<li data-line="3">升级的时候先针对某个实例，升级完成后再逐步调高权重放一小部分用户进来做测试，确认无误再彻底回调比例并升级其他实例</li>
</ul>
</li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="环境隔离" class="heading" id="环境隔离"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>环境隔离</h4><div class="heading-children"><div class="heading-wrapper"><h5 data-heading="概念" class="heading" id="概念"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>概念</h5><div class="heading-children"><div><p>Nacos中服务存储和数据存储的最外层都是一个名为namespace的东西，用来做最外层隔离——&gt;将业务相关的服务和数据至于同一个Group里边。<strong>【非必须】</strong></p></div><div><ul>
<li data-line="0">namespace用来做环境隔离</li>
<li data-line="1">每个namespace都有唯一id</li>
<li data-line="2"><strong>不同namespace下的服务不可见</strong></li>
</ul></div><div><p><img alt="image-20230117101639160" src="https://i0.hdslb.com/bfs/album/c194f1389c8396c1e418e40b5f844ac02ff17591.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="环境设置" class="heading" id="环境设置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>环境设置</h5><div class="heading-children"><div><ul>
<li data-line="0">
<p>在控制台创建一个新的namespace（自动生成唯一id）</p>
<p><img alt="image-20230117102152571" src="https://i0.hdslb.com/bfs/album/6e9add7bfc85d4348c864e4880a1c07bb2136205.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
<p><img alt="image-20230117102229240" src="https://i0.hdslb.com/bfs/album/ec692303fa211bfff3353353a7cf19963eb7257d.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
<p><img alt="image-20230117102219139" src="https://i0.hdslb.com/bfs/album/8ebe73dd92ee11860b836ae139fa07ffab0501a9.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
<li data-line="10">
<p>在IDEA项目配置文件中添加新的属性字段通过唯一id进行环境隔离</p>
<p><img alt="image-20230117102249938" src="https://i0.hdslb.com/bfs/album/e5a7c6b61f6f3175b1687367f31b1836c1ba4604.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
</ul></div><div><p>之后Nacos控制台就会显示新创建的namespace，默认都属于public空间</p></div><div><p><img alt="image-20230117102447249" src="https://i0.hdslb.com/bfs/album/314f884a07b4f892513e7c7de128751ab418e758.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>且不同命名空间的实例将不能相互访问。</p></div></div></div></div></div><div class="heading-wrapper"><h4 data-heading="Nacos和Eureka的区别【主动、集群、隔离】" class="heading" id="Nacos和Eureka的区别【主动、集群、隔离】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Nacos和Eureka的区别【主动、集群、隔离】</h4><div class="heading-children"><div><ul>
<li data-line="0"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>Nacos与eureka的共同点</p>
<ul>
<li data-line="1">都支持服务注册和服务拉取</li>
<li data-line="2">都支持服务提供者心跳方式做健康检测</li>
</ul>
</li>
<li data-line="4"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>Nacos与Eureka的区别</p>
<ul>
<li data-line="5">Nacos支持服务端主动检测提供者状态:临时实例采用心跳模式，非临时实例采用主动检测模式</li>
<li data-line="6">临时实例心跳不正常会被剔除，非临时实例则不会被剔除</li>
<li data-line="7">Nacos支持服务列表变更的消息推送模式，服务列表更新更及时</li>
<li data-line="8">Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式;Eureka采用AP方式</li>
</ul>
</li>
</ul></div><div><p><strong>Nacos更加细节</strong></p></div><div><p>也可以更加主动，不过一般是临时实例来减轻服务器的负担</p></div><div><p><img alt="image-20230117105137222" src="https://i0.hdslb.com/bfs/album/419fb8940ad349c7de50900aa3f52f00bd32de1d.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>临时实例和非临时实例的设置（配置文件spring-cloud-nacos-discovery-ephemeral：false  设置为非临时实例）</p></div><div><p><img alt="image-20230117104854803" src="https://i0.hdslb.com/bfs/album/8d58cb316c9d6bd7908a97d31675bd0555b1084b.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="6、配置管理" class="heading" id="6、配置管理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>6、配置管理</h3><div class="heading-children"><div><p>微服务成百上千之后我们不可能单独去修改一个配置文件，不仅修改麻烦更新也麻烦——&gt;所以我们将配置交由配置中心进行统一管理就像注册中心一样，而恰巧，Nacos不仅能作为注册中心同时也能充当配置中心完成配置管理服务</p></div><div><p><mark>我们只是把一些重要的信息配置到Nacos中以便“热更新”而不是把微服务的所有配置都交由Nacos进行管理</mark></p></div><div><blockquote>
<p>反之，注册中心和配置管理也是可以单独出来进行管理</p>
</blockquote></div><div><p><img alt="image-20230117105851480" src="https://i0.hdslb.com/bfs/album/b56ee14016724fc0a752db3bb742fa139b2aa764.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div class="heading-wrapper"><h4 data-heading="Nacos统一管理配置" class="heading" id="Nacos统一管理配置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Nacos统一管理配置</h4><div class="heading-children"><div><p>直接在控制台创建即可</p></div><div><p><img alt="image-20230117110616378" src="https://i0.hdslb.com/bfs/album/906b83f75d03f296e305b0c81b3ebbe926daf33d.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>设置配置内容时只需要把<strong>部分</strong>“热更新”相关的配置写进去</p></div><div><p><img alt="image-20230117110717154" src="https://i0.hdslb.com/bfs/album/7b0589929c7f6b978cc723735481d6403c410a57.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="微服务配置拉取配置" class="heading" id="微服务配置拉取配置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>微服务配置拉取配置</h4><div class="heading-children"><div><p><strong>配置获取的逻辑设计</strong></p></div><div><p><img alt="image-20230117111735849" src="https://i0.hdslb.com/bfs/album/93845431a0c0ae4baa5fb686d0f492c9fae48c63.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>代码实现</strong></p></div><div><ul>
<li data-line="0">在微服务中引入nacos的config依赖</li>
<li data-line="1">在微服务中添加bootstrap.yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件<img alt="image-20230117111613542" src="https://i0.hdslb.com/bfs/album/d0709d3f53019f6e2054accaf209e939a0609535.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></li>
</ul></div></div></div><div class="heading-wrapper"><h4 data-heading="流程总结" class="heading" id="流程总结"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>流程总结</h4><div class="heading-children"><div><ol>
<li data-line="0">在Nacos中添加配置文件</li>
<li data-line="1">在微服务中引入nacos的config依赖</li>
<li data-line="2">在微服务中添加bootstrap.yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件</li>
</ol></div></div></div><div class="heading-wrapper"><h4 data-heading="配置热更新" class="heading" id="配置热更新"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>配置热更新</h4><div class="heading-children"><div><p>Nacos配置更改后，微服务可以实现热更新，方式有二:</p></div><div><ul>
<li data-line="0">通过@Value注解注入，需要在类上结合@RefreshScope来刷新</li>
<li data-line="1"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>通过@ConfigurationProperties注入，自动刷新✔️
<ul>
<li data-line="2">不是所有的配置都适合放到配置中心,维护起来比较麻烦</li>
<li data-line="3">建议将一些关键参数，需要运行时调整的参数放到nacos配<br>
置中心，一般都是自定义配置</li>
</ul>
</li>
</ul></div><div><p><strong>例子：</strong> 通过@ConfigurationProperties注入，自动刷新</p></div><div><p>Nacos统一管理配置</p></div><div><p><img alt="image-20230117114359715" src="https://i0.hdslb.com/bfs/album/adc36e91b49b5c4303831aaabc6b35c1b3dc2893.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>配置类封装映射配置属性</p></div><div><p><img alt="image-20230117114152961" src="https://i0.hdslb.com/bfs/album/b993d71e195f0e305e139718bcc00026679776eb.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>程序调用读取配置</p></div><div><p><img alt="image-20230117114242383" src="https://i0.hdslb.com/bfs/album/3b2c21beebf3245efad6936f9953821ba3f2068c.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="多环境配置共享" class="heading" id="多环境配置共享"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>多环境配置共享</h4><div class="heading-children"><div><p>微服务启动时会从nacos读取多个配置文件:【<u>微服务启动时的加载顺序</u>】</p></div><div><ul>
<li data-line="0"><code>[spring.application.name]-[spring.profiles.active].yaml</code>，例如:userservice-dev.yaml</li>
<li data-line="1"><code>[spring.application.name].yaml</code>，例如: userservice.yaml</li>
</ul></div><div><p><mark>无论profile如何变化，[spring.application.name].yaml这个文件一定会加载，因此多环境共享配置可以写入这个文件</mark></p></div><div><p><img alt="image-20230117114828650" src="https://i0.hdslb.com/bfs/album/0d75fd10bc70f887182f4464a9c15bca180d35b7.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>小结</strong></p></div><div><p>微服务会从nacos读取的配置文件:</p></div><div><ul>
<li data-line="0"><code>[服务名]-[spring.profile.active].yaml</code>，环境配置</li>
<li data-line="1"><code>[服务名].yaml</code>，默认配置，多环境共享</li>
</ul></div><div><p>但是要注意<mark>配置文件的优先级</mark>，优先级高的将覆盖优先级低的配置</p></div><div><p><strong>优先级:[服务名]-[环境].yaml&gt;[服务名].yaml&gt;本地配置</strong></p></div></div></div><div class="heading-wrapper"><h4 data-heading="搭建Nacos集群【高可用】" class="heading" id="搭建Nacos集群【高可用】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>搭建Nacos集群【高可用】</h4><div class="heading-children"><div><p>大公司肯定不会只有一个Nacos服务器，为保证高可用他们会购置多台服务器来搭建Nacaos集群</p></div><div class="heading-wrapper"><h5 data-heading="集群架构图" class="heading" id="集群架构图"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>集群架构图</h5><div class="heading-children"><div><p><img alt="image-20230117121229904" src="https://i0.hdslb.com/bfs/album/5fa744b13b17407cbd1ccb55b757a326ac53abbc.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h5 data-heading="集群搭建步骤" class="heading" id="集群搭建步骤"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>集群搭建步骤</h5><div class="heading-children"><div><p><strong>详细步骤：</strong></p></div><div><p><a data-href="Nacos集群搭建" href="技术/后端/java/nacos集群搭建.html" class="internal-link" target="_self" rel="noopener">Nacos集群搭建</a></p></div><div><p><strong>小结：</strong></p></div><div><ol>
<li data-line="0">
<p>搭建MySQL集群并初始化数据库表</p>
<blockquote>
<p>Nacos官方提供了标准的SQL创建，用来记录数据库信息</p>
</blockquote>
</li>
<li data-line="4">
<p>下载解压nacos</p>
</li>
<li data-line="6"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>修改集群配置（节点信息）、数据库配置</p>
<ul>
<li data-line="8">nacos结点信息：创建nacos-config-cluster.config添加nacos结点信息【此处模拟单例，实际上是不同的实例ip】</li>
</ul>
<p><img alt="image-20230117122431103" src="https://i0.hdslb.com/bfs/album/07b53d01fcecef66722bc98fd105ab247e3513ee.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
<ul>
<li data-line="12">
<p>数据库配置：修改application.properties文件，添加数据库配置。【告知：指定mysql集群，数据库数量、数据库连接配置】</p>
<p>构建<strong>数据库集群</strong>保证数据库读写都在集群中完成保证数据共享一致性。</p>
<p><img alt="image-20230117122718273" src="https://i0.hdslb.com/bfs/album/9570147ac81625bb768dd4f110d96a3a91500d78.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
</ul>
</li>
<li data-line="18">
<p>分别启动多个nacos节点</p>
<p>我们可以直接拷贝之前创建的nacos文件夹，然后依次修改application.properties文件的nacos对外服务端口Service.port，然后分别启动模拟不同主机启动了nacos服务。直接在bin目录下执行<code>startup.cmd</code>即可，默认是集群启动。</p>
<p><img alt="image-20230117123905086" src="https://i0.hdslb.com/bfs/album/25ae29d2b36d4e0b56f5a18d961fa5db43526861.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
<li data-line="24">
<p>nginx反向代理</p>
<p>作为gateway用来实现对Nacos的负载均衡。以下配置都要在config目录中的http作用域中配置生效。</p>
<p><img alt="image-20230117125942893" src="https://i0.hdslb.com/bfs/album/3f74e6c3ef94aaab837ee880316b75bef23a4018.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
</ol></div><div><p>之后就可以通过网关Nginx访问我们的集群</p></div><div><p>之后的配置管理都将持久化到数据库中</p></div><div><p><img alt="image-20230117125726593" src="https://i0.hdslb.com/bfs/album/ac02a91f0211cc6d3c855d93bacecb7417615b9d.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="二、网关" class="heading" id="二、网关"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>二、网关</h2><div class="heading-children"><div><p><mark>微服务治理还有一个重要事项就是统一网关</mark></p></div><div class="heading-wrapper"><h3 data-heading="1、什么是网关" class="heading" id="1、什么是网关"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1、什么是网关</h3><div class="heading-children"><div><ul>
<li data-line="0">
<p>身份认证和权限校验</p>
</li>
<li data-line="2">
<p>服务路由、负载均衡</p>
</li>
<li data-line="3">
<p>请求限流</p>
</li>
</ul></div><div><p><img alt="image-20230117163937154" src="https://i0.hdslb.com/bfs/album/269b89dcc41d1e114e08e35fd2f0dec7c08be5ab.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>在SpringCloud中网关的实现包括两种:</strong></p></div><div><ul>
<li data-line="0">
<p><strong>gateway</strong></p>
</li>
<li data-line="2">
<p>zuul</p>
</li>
</ul></div><div><p>Zuul是基于Servlet的实现，属于阻塞式编程。而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于响应式编程的实现，具备更好的性能。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="2、搭建网关" class="heading" id="2、搭建网关"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2、搭建网关</h3><div class="heading-children"><div><p>网关是一个独立的服务，所以需要新建模块，引入相关依赖，配置文件设置相关配置，再启动类启动网关服务。</p></div><div><p><strong>搭建网关服务的步骤:</strong></p></div><div><p>1.创建项目（模块），引入nacos服务发现和gateway依赖</p></div><div><p><img alt="image-20230117181644898" src="https://i0.hdslb.com/bfs/album/5fad7b2101604363d3602d0c686ca55972bf8266.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>2．配置application.yml，包括服务基本信息、nacos地址、路由</p></div><div><p><img alt="image-20230117181755939" src="https://i0.hdslb.com/bfs/album/8045740b15faa1a39e9be09addd07b176880b949.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved">路由配置包括:</p></div><div><ul>
<li data-line="0">
<p>路由id:路由的唯一标示</p>
</li>
<li data-line="1">
<p>路由目标（uri):路由的目标地址，http代表固定地址，lb代表根据服务名负载均衡</p>
</li>
<li data-line="2">
<p>路由断言(predicates) :判断路由的规则，</p>
</li>
<li data-line="3">
<p>路由过滤器（(filters) :对请求或响应做处理</p>
<p>3.通过启动类启动网关服务</p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="3、路由断言工厂" class="heading" id="3、路由断言工厂"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3、路由断言工厂</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="什么是断言" class="heading" id="什么是断言"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>什么是断言</h4><div class="heading-children"><div><p><strong>抽象图</strong></p></div><div><p><img alt="image-20230117174123199" src="https://i0.hdslb.com/bfs/album/b6bb851c9fd6d5f79235376a23516937889c81bb.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>网关路由可以配置的内容包括:</p></div><div><ul>
<li data-line="0">路由id:路由唯一标示</li>
<li data-line="1">uri:路由目的地，支持lb和http两种（lb即loadBalanced）</li>
<li data-line="2"><strong>predicates:路由断言，判断请求是否符合要求，符合则转发到路由目的地</strong></li>
<li data-line="3">filters:路由过滤器，处理请求或响应</li>
</ul></div><div><p><img alt="image-20230117173307915" src="https://i0.hdslb.com/bfs/album/81e3853de7f174be8b93361ae9b544261cc01880.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h4 data-heading="Predicate工厂" class="heading" id="Predicate工厂"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Predicate工厂</h4><div class="heading-children"><div><p>我们在<mark>配置文件中写的断言规则只是字符串，这些字符串会被Predicate Factory读取并处理，转变为路由判断的条件</mark><br>
例如Path=/user/**是按照路径匹配，这个规则是由<br>
<code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>类来处理的</p></div><div><p>像这样的断言工厂在SpringCloudGateway还有十几个，主要用的是Path，具体情况分析官方文档现查。</p></div><div><p><img alt="image-20230117173151281" src="https://i0.hdslb.com/bfs/album/b3d766b52a872e8f6da449dcd3d4316e89335cdc.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>问答</strong></p></div><div><ul>
<li data-line="0">
<p>PredicateFactory的作用是什么?</p>
<p>读取用户定义的断言条件，对请求做出判断</p>
</li>
<li data-line="4">
<p>Path=/user/**是什么含义?<br>
路径是以/user开头的就认为是符合的</p>
</li>
</ul></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="4、路由的过滤器配置【过滤器工厂】" class="heading" id="4、路由的过滤器配置【过滤器工厂】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4、路由的过滤器配置【过滤器工厂】</h3><div class="heading-children"><div><p>Spring提供了31种不同的路由过滤器工厂，都有不同的过滤规则，具体参见官方文档。</p></div><div><p><img alt="image-20230117175624627" src="https://i0.hdslb.com/bfs/album/431ac5a9a7e1b1e1f99c2cc582190cdf420a7818.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>分为当前过滤器和全局过滤器，在配置文件中根据层级的不同，作用范围也就不同。</p></div><div><ul>
<li data-line="0">
<p>配置当前过滤器</p>
<p><img alt="image-20230117175429178" src="https://i0.hdslb.com/bfs/album/694d3faa2526514740beeee33a46f3aa43d29cd0.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
<li data-line="4">
<p>配置默认过滤器【全局】</p>
<p><img alt="image-20230117175402397" src="https://i0.hdslb.com/bfs/album/15e780b3c3fa051a9dafd20d2d2700f4a2a0db3d.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="5、全局过滤器【自定义】" class="heading" id="5、全局过滤器【自定义】"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5、全局过滤器【自定义】</h3><div class="heading-children"><div><p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与GatewayFilter的作用一样。<br>
区别在于GatewayFilter通过配置定义，处理逻辑是固定的。</p></div><div><p>而<mark>GlobalFilter的逻辑需要自己写代码实现</mark>。定义方式是实现GlobalFilter接口。</p></div><div><p><strong>实现全局过滤器的步骤</strong></p></div><div><ul>
<li data-line="0">实现GlobalFilter接口</li>
<li data-line="1">添加@Order注解或实现Ordered接口编写处理逻辑<strong>【必须指定顺序值】</strong></li>
</ul></div><div><p><strong>示例：</strong></p></div><div><p><img alt="image-20230117172732459" src="https://i0.hdslb.com/bfs/album/aad72d52cb1dc3a9c58fbddfb1fdd2b766b76313.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>Tip：</p></div><div><ul>
<li data-line="0">GlobalFilter使用的不是HttpServer，而是ServerWebExchange对象，方法有所不同</li>
<li data-line="1">除了通过@Order()注解定义顺序外也可以实现ordered接口重写getOrdered()方法指定顺序</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="6、过滤器链执行顺序" class="heading" id="6、过滤器链执行顺序"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>6、过滤器链执行顺序</h3><div class="heading-children"><div><p><strong>按照orderId从小到大的顺序执行，当大小相同则按优先级来：默认过滤器——路由过滤器——全局过滤器</strong></p></div><div><p><strong>分析：</strong></p></div><div><p><img alt="image-20230117174416374" src="https://i0.hdslb.com/bfs/album/18b872b59840fd0d51d5b32025f2d3d874391b01.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>请求进入网关会碰到三类过滤器:当前路由的过滤器、DefaultFilter、GlobalFilter<br>
请求路由后，会将当前路由过滤器和DefaultFilter、GlobalFilter，合并到一个<strong>过滤器链(集合)</strong>中，排序后依次执行每个过滤器</p></div><div><div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Tip</div></div><div class="callout-content">
<p>网关中提供了一个过滤器适配器，有一个GatewayFilterAdapter类实现了GatewayFilter接口，它可以将全局过滤器类型转换成<mark>GatewayFilter类型</mark>，当前过滤器和默认过滤器在底层其实也相似，他们最终都会转换成GatewayFilter类型，所以他们可以放到一个集合</p>
</div></div></div><div><p>每一个过滤器都必须指定一个int类型的order值，<mark>order值越小，优先级越高，执行顺序越靠前。</mark></p></div><div><p>GlobalFilter通过实现Ordered接口，或者添加@Order注解来指定order值，由我们自己指定</p></div><div><p>路由过滤器和defaultFilter的order由Spring指定，默认是按照声明顺序从1递增。<br>
<strong>当过滤器的order值一样时，会按照defaultFilter &gt;路由过滤器&gt;GlobalFilter的顺序执行。</strong></p></div><div><p><img alt="image-20230117180655726" src="https://i0.hdslb.com/bfs/album/3dfe544f8b24f05d9dd2606a8666f07feb266df5.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div></div></div><div class="heading-wrapper"><h3 data-heading="7、网关的cors跨域配置" class="heading" id="7、网关的cors跨域配置"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>7、网关的cors跨域配置</h3><div class="heading-children"><div><p>首先微服务内部是不会产生跨域问题的，所以只需要对网关进行跨域处理。</p></div><div><p>跨域:域名不一致就是跨域，主要包括:</p></div><div><ul>
<li data-line="0">域名不同: <a data-tooltip-position="top" aria-label="http://www.taobao.com和www.taobao.org和www.jd.com和miaosha.jd.com" rel="noopener" class="external-link is-unresolved" href="http://www.taobao.com%E5%92%8Cwww.taobao.org%E5%92%8Cwww.jd.com%E5%92%8Cmiaosha.jd.com" target="_self">www.taobao.com和www.taobao.org和www.jd.com和miaosha.jd.com</a></li>
<li data-line="1">域名相同，端口不同: localhost:8080和localhost8081</li>
</ul></div><div><p>跨域问题:<strong>浏览器禁止</strong>请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题解决方案: CORS</p></div><div><p><img alt="image-20230117183047449" src="https://i0.hdslb.com/bfs/album/33e8561649d893b8fba3d46a93fe4b928214c4b0.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p><strong>网关封装好的处理方案，只需进行配置皆可</strong></p></div><div><p><img alt="image-20230117183657607" src="https://i0.hdslb.com/bfs/album/8dd77fd8ff060fa324466c100f7745d6aa9ead8e.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></p></div><div><p>关于CORS跨域要配置的参数包括哪几个?会CV就行。</p></div><div><ul>
<li data-line="0">允许哪些域名跨域?</li>
<li data-line="1">允许哪些请求头?</li>
<li data-line="2">允许哪些请求方式?</li>
<li data-line="3">是否允许使用cookie?</li>
<li data-line="4">有效期是多久?</li>
</ul></div><div class="mod-footer"></div></div></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="outline-tree tree-container"><div class="tree-item nav-folder mod-root" data-depth="0"><div class="tree-item-self nav-folder-title"><div class="tree-item-inner nav-folder-title-content">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item-children nav-folder-children"><div class="nav-folder-spacer"></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#SpringCloud" data-path="#SpringCloud"><div class="tree-item-inner heading-link" heading-name="SpringCloud">SpringCloud</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#一、服务拆分" data-path="#一、服务拆分"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="一、服务拆分">一、服务拆分</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#1、微服务事项" data-path="#1、微服务事项"><div class="tree-item-inner heading-link" heading-name="1、微服务事项">1、微服务事项</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#2、微服务项目结构" data-path="#2、微服务项目结构"><div class="tree-item-inner heading-link" heading-name="2、微服务项目结构">2、微服务项目结构</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#3、微服务远程调用" data-path="#3、微服务远程调用"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3、微服务远程调用">3、微服务远程调用</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#远程调用原理" data-path="#远程调用原理"><div class="tree-item-inner heading-link" heading-name="远程调用原理">远程调用原理</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#基于Feign的远程调用" data-path="#基于Feign的远程调用"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="基于Feign的远程调用">基于Feign的远程调用</div></a><div class="tree-item-children"><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#基本使用" data-path="#基本使用"><div class="tree-item-inner heading-link" heading-name="基本使用">基本使用</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#自定义配置" data-path="#自定义配置"><div class="tree-item-inner heading-link" heading-name="自定义配置">自定义配置</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#性能优化" data-path="#性能优化"><div class="tree-item-inner heading-link" heading-name="性能优化">性能优化</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#Feign的最佳实践" data-path="#Feign的最佳实践"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Feign的最佳实践">Feign的最佳实践</div></a><div class="tree-item-children"><div class="tree-item" data-depth="6"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#1）分析" data-path="#1）分析"><div class="tree-item-inner heading-link" heading-name="1）分析">1）分析</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="6"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#2）实践" data-path="#2）实践"><div class="tree-item-inner heading-link" heading-name="2）实践">2）实践</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#4、Eureka架构【注册/监控】⭐️" data-path="#4、Eureka架构【注册/监控】⭐️"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="4、Eureka架构【注册/监控】⭐️">4、Eureka架构【注册/监控】⭐️</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#概念原理" data-path="#概念原理"><div class="tree-item-inner heading-link" heading-name="概念原理">概念原理</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#搭建Eureka" data-path="#搭建Eureka"><div class="tree-item-inner heading-link" heading-name="搭建Eureka">搭建Eureka</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#服务注册" data-path="#服务注册"><div class="tree-item-inner heading-link" heading-name="服务注册">服务注册</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#服务发现" data-path="#服务发现"><div class="tree-item-inner heading-link" heading-name="服务发现">服务发现</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#流程总结" data-path="#流程总结"><div class="tree-item-inner heading-link" heading-name="流程总结">流程总结</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#负载均衡原理及策略更改" data-path="#负载均衡原理及策略更改"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="负载均衡原理及策略更改">负载均衡原理及策略更改</div></a><div class="tree-item-children"><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#负载均衡流程（负载均衡器Ribbon）⭐️" data-path="#负载均衡流程（负载均衡器Ribbon）⭐️"><div class="tree-item-inner heading-link" heading-name="负载均衡流程（负载均衡器Ribbon）⭐️">负载均衡流程（负载均衡器Ribbon）⭐️</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#负载均衡策略" data-path="#负载均衡策略"><div class="tree-item-inner heading-link" heading-name="负载均衡策略">负载均衡策略</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#更改负载均衡策略" data-path="#更改负载均衡策略"><div class="tree-item-inner heading-link" heading-name="更改负载均衡策略">更改负载均衡策略</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#饥饿加载" data-path="#饥饿加载"><div class="tree-item-inner heading-link" heading-name="饥饿加载">饥饿加载</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#总结" data-path="#总结"><div class="tree-item-inner heading-link" heading-name="总结">总结</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#5、Nacos架构【注册/监控/集群/环境隔离】⭐️" data-path="#5、Nacos架构【注册/监控/集群/环境隔离】⭐️"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="5、Nacos架构【注册/监控/集群/环境隔离】⭐️">5、Nacos架构【注册/监控/集群/环境隔离】⭐️</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#服务多级存储模型【地域访问/容灾】" data-path="#服务多级存储模型【地域访问/容灾】"><div class="tree-item-inner heading-link" heading-name="服务多级存储模型【地域访问/容灾】">服务多级存储模型【地域访问/容灾】</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#NacosRule的负载均衡" data-path="#NacosRule的负载均衡"><div class="tree-item-inner heading-link" heading-name="NacosRule的负载均衡">NacosRule的负载均衡</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#服务实例的权重设置" data-path="#服务实例的权重设置"><div class="tree-item-inner heading-link" heading-name="服务实例的权重设置">服务实例的权重设置</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#环境隔离" data-path="#环境隔离"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="环境隔离">环境隔离</div></a><div class="tree-item-children"><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#概念" data-path="#概念"><div class="tree-item-inner heading-link" heading-name="概念">概念</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#环境设置" data-path="#环境设置"><div class="tree-item-inner heading-link" heading-name="环境设置">环境设置</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#Nacos和Eureka的区别【主动、集群、隔离】" data-path="#Nacos和Eureka的区别【主动、集群、隔离】"><div class="tree-item-inner heading-link" heading-name="Nacos和Eureka的区别【主动、集群、隔离】">Nacos和Eureka的区别【主动、集群、隔离】</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#6、配置管理" data-path="#6、配置管理"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="6、配置管理">6、配置管理</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#Nacos统一管理配置" data-path="#Nacos统一管理配置"><div class="tree-item-inner heading-link" heading-name="Nacos统一管理配置">Nacos统一管理配置</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#微服务配置拉取配置" data-path="#微服务配置拉取配置"><div class="tree-item-inner heading-link" heading-name="微服务配置拉取配置">微服务配置拉取配置</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#流程总结" data-path="#流程总结"><div class="tree-item-inner heading-link" heading-name="流程总结">流程总结</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#配置热更新" data-path="#配置热更新"><div class="tree-item-inner heading-link" heading-name="配置热更新">配置热更新</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#多环境配置共享" data-path="#多环境配置共享"><div class="tree-item-inner heading-link" heading-name="多环境配置共享">多环境配置共享</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#搭建Nacos集群【高可用】" data-path="#搭建Nacos集群【高可用】"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="搭建Nacos集群【高可用】">搭建Nacos集群【高可用】</div></a><div class="tree-item-children"><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#集群架构图" data-path="#集群架构图"><div class="tree-item-inner heading-link" heading-name="集群架构图">集群架构图</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#集群搭建步骤" data-path="#集群搭建步骤"><div class="tree-item-inner heading-link" heading-name="集群搭建步骤">集群搭建步骤</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#二、网关" data-path="#二、网关"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="二、网关">二、网关</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#1、什么是网关" data-path="#1、什么是网关"><div class="tree-item-inner heading-link" heading-name="1、什么是网关">1、什么是网关</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#2、搭建网关" data-path="#2、搭建网关"><div class="tree-item-inner heading-link" heading-name="2、搭建网关">2、搭建网关</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#3、路由断言工厂" data-path="#3、路由断言工厂"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3、路由断言工厂">3、路由断言工厂</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#什么是断言" data-path="#什么是断言"><div class="tree-item-inner heading-link" heading-name="什么是断言">什么是断言</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#Predicate工厂" data-path="#Predicate工厂"><div class="tree-item-inner heading-link" heading-name="Predicate工厂">Predicate工厂</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#4、路由的过滤器配置【过滤器工厂】" data-path="#4、路由的过滤器配置【过滤器工厂】"><div class="tree-item-inner heading-link" heading-name="4、路由的过滤器配置【过滤器工厂】">4、路由的过滤器配置【过滤器工厂】</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#5、全局过滤器【自定义】" data-path="#5、全局过滤器【自定义】"><div class="tree-item-inner heading-link" heading-name="5、全局过滤器【自定义】">5、全局过滤器【自定义】</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#6、过滤器链执行顺序" data-path="#6、过滤器链执行顺序"><div class="tree-item-inner heading-link" heading-name="6、过滤器链执行顺序">6、过滤器链执行顺序</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="技术/后端/java/微服务治理.html#7、网关的cors跨域配置" data-path="#7、网关的cors跨域配置"><div class="tree-item-inner heading-link" heading-name="7、网关的cors跨域配置">7、网关的cors跨域配置</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>